MASTER LOAD BLOCK                                            ÿ                                                                  1þ18þthruþLoad basic system                                                                                                     20þloadþ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        MAIN ENTRY POINT execute-forthÿ                þþþþþþþþþþ þþþþþþÿÿ55hþc,þ  ýý  þþþþþþþ ýýpush ebp                               ýý8Bhþc,þEChþc,þþþþþþþþ  mov ebp,esp                              60hþc,þþþ              pusha                               þþþýý8Bhþc,þ7Dhþc,þ08hþc,þýýmov edi,[ebp+8]                 þþþþþþþ  8Bhþc,þ6Fhþc,þ00hþc,þý mov ebp,[edi+0] (dstack_ptr) ýýýþþþþþþþ  83hþc,þEDhþc,þ08hþc,þýýsub ebp,8                þþþþþþþþþþþþþþ  8Bhþc,þ5Dhþc,þ04hþc,þþþmov ebx,[ebp+4]                 þþþþþþþ  8Bhþc,þ45hþc,þ08hþc,þþþmov eax,[ebp+8]                 þþþþþþþ  FFhþc,þD0hþc,þþþþþþþþþþcall eax                        þþþþþþþ  83hþc,þC5hþc,þ04hþc,þþþadd ebp,4                       þþþþþþþ  89hþc,þ5Dhþc,þ00hþc,þþþmov [ebp],ebx                  þþþþþþþþ  89hþc,þ6Fhþc,þ00hþc,þþþmov [edi+0],ebp (dstack_ptr)    þþþþþþþ  61hþc,þ             þ  popa                            þþþþþþþþþ5Dhþc,þ             þ  pop ebp                         þþþþþþ þþC3hþc,þþþþþþþþþþþþþþþþþret                             þþþþþþþIMPLEMENT compile,ÿDIRECTLY                                                                                              ýýþþþþþ8Bhþc,þ47hþc,þ04hþc,þþþmov eax,[edi+4] ( here )        ÿÿÿÿÿÿÿÿÿC6hþc,þ00hþc,þE8hþc,þþþmov [eax],E8h ( call xxxx )     ÿÿÿÿÿÿÿÿÿ2Bhþc,þD8hþc,þþþ      þsub ebx,eax                             þ83hþc,þEBhþc,þ05hþc,þ  sub ebx,5                                89hþc,þ58hþc,þ01hþc,þþþmov [eax+1],ebx            þþþþ ÿÿÿÿÿÿÿÿÿ8Dhþc,þ40hþc,þ05hþc,þþþlea eax,[eax+5]             þþþ ÿÿÿÿÿÿÿÿÿ89hþc,þ47hþc,þ04hþc,þþ mov [edi+4],eax ( here ) þþþþ   ÿÿÿÿÿÿÿÿÿ8Bhþc,þ5Dhþc,þ00hþc,þþþmov ebx,[ebp]                  þÿÿÿÿÿÿÿÿÿ83hþc,þEDhþc,þ04hþc,þþþsub ebp,4                       ÿÿÿÿÿÿÿÿÿC3hþc,þþþþþþþþþþþþþþþþþret                             ÿÿÿÿÿÿÿÿÿ                                                                                                                                                                                                                                                                IMPLEMENT literalÿDIRECTLY                                     þ      þ                                                         8Bhþc,þ47hþc,þ04hþc,þþþmov eax,[edi+4] ( here )        ÿÿÿÿÿÿÿÿÿC7hþc,þ00hþc,þþþþþþþþþþmov [eax],dword x  þþþþþþ     þþþþþ   þþþþþþþþþþ83hþc,þC5hþc,þ04hþc,þ89hþc,þ         | add ebp,4         C7hþc,þ40hþc,þ04hþc,þþþmov [eax+4],dword x  | mov [ebp],ebx            5Dhþc,þ00hþc,þBBhþc,þ00hþc,þ         | mov ebx,x þþþþþ   89hþc,þ58hþc,þ07hþc,þþþmov [eax+7],ebx            þþþþ ÿÿÿÿÿÿÿÿÿ8Dhþc,þ40hþc,þ0Bhþc,þþþlea eax,[eax+11]            þþþ ÿÿÿÿÿÿÿÿÿ89hþc,þ47hþc,þ04hþc,þþþmov [edi+4],eax                          8Bhþc,þ5Dhþc,þ00hþc,þþþmov ebx,[ebp]                  þÿÿÿÿÿÿÿÿÿ83hþc,þEDhþc,þ04hþc,þþþsub ebp,4                       ÿÿÿÿÿÿÿÿÿC3hþc,þþþþþþþþþþþþþþþþþret                             ÿÿÿÿÿÿÿÿÿ                                                                                                                                                                                                WORDS TO COMPILE BYTES AND CELLS                                c,ÿsmudgeþþ8Bhþc,þ47hþc,þ04hþc,þ  mov eax,[edi+4]                 ÿþþþþþþþþ88hþc,þ18hþc,þþþþþþþþþþmov [eax],bl                    ÿþþþþþþþþFFhþc,þ47hþc,þ04hþc,þþþinc [edi+4]                     ÿþþþþþþþþ8Bhþc,þ5Dhþc,þ00hþc,þþþmov ebx,[ebp]                   ÿþþþþþþþþ83hþc,þEDhþc,þ04hþc,þþþsub ebp,4                       ÿþþþþþþþþC3hþc,þþþþþþþþþþþþþþþþþret         þþþþþþþþþþþ      þþ unsmudgeþ                                                    þ                                                                ,ÿ8Bhþc,þ47hþc,þ04hþc,þ       þþmov eax,[edi+4]                   89hþc,þ18hþc,þþþþþþþþþ       þmov [eax],ebx                     83hþc,þ47hþc,þ04hþc,þ04hþc,þþþadd [edi+4],04h              þþ   8Bhþc,þ5Dhþc,þ00hþc,þ         mov ebx,[ebp]                   þþ83hþc,þEDhþc,þ04hþc,þ         sub ebp,4                 þþþ   þþC3hþc,þþþþþþþþþþþþþþþþþþþþþþþþret                           þþ                                                                CALL HANDLING macroþDEFINITIONS                                                                                                 ;ÿC3hýc,ýC3hþc,þþþret                              ÿÿÿÿÿ þþþþþþþ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                þþþþþþ                                               þþþ  forthþSTACK MANIPULATION macroþDEFINITIONS                         þ  ÿnipÿ83hýc,ýEDhýc,ý04hýc,ý;ýsub ebp,4                  þþþþþþþþþ                                                                swapÿ8Bhýc,ý45hýc,ý00hýc,ýþþmov eax,[ebp]                    þþþ     89hýc,ý5Dhýc,ý00hýc,ýþþmov [ebp],ebx                     þþ     8Bhýc,ýD8hýc,ýýýþþþþþ;ýmov ebx,eax                     þþþþ                                                                dropÿ8Bhýc,ý5Dhýc,ý00hýc,ý þmov ebx,[ebp]                            nipüüüüüüüüüüüüüüüüüý;ýüüüüüüüüüü                 þþþþþþþþþ                                                                ÿdupÿ83hýc,ýC5hýc,ý04hýc,ýþþadd ebp,4                         ÿþ     89hýc,ý5Dhýc,ý00hýc,ý;ýmov [ebp],ebx                                                                                       overÿ8Bhýc,ý45hýc,ý00hýc,ýýýmov eax,[ebp]              ÿÿÿÿÿÿÿÿý     dupü   8Bhýc,ýD8hýc,ý;ýmov ebx,eax                        ü                                                     þþþ  forthþIN-PLACE ARITHMETIC macroþDEFINITIONS                                                                                          ÿ1+ÿ43hýc,ý;ýinc ebx                                            ÿ1-ÿ4Bhýc,ý;ýdec ebx                                        ÿÿþþþ2+ÿ83hýc,ýC3hýc,ý02hýc,ý;ýadd ebx,2                             2-ÿ83hýc,ýEBhýc,ý02hýc,ý;ýsub ebx,2                             4+ÿ83hýc,ýC3hýc,ý04hýc,ý;ýadd ebx,4                             4-ÿ83hýc,ýEBhýc,ý04hýc,ý;ýsub ebx,4                                                                                             2*ÿD1hýc,ýE3hýc,ý;ýsal ebx,1                              þþþþþþ2/ÿD1hýc,ýFBhýc,ý;ýsar ebx,1                                   þ                                                                negateÿF7hýc,ýDBhýc,ý;ýneg ebx                             þþþþþ                                                                                                                                                                                   þþþþ   forthþADDITION AND SUBTRACTION macroþDEFINITIONS                                                                                      +ÿ03hýc,ý5Dhýc,ý00hýc,ýþþadd ebx,[ebp]                     ÿþþþþ  83hýc,ýEDhýc,ý04hýc,ý;ýsub ebp,4                         þþþþ                                                                 -ÿ29hýc,ý5Dhýc,ý00hýc,ýþþsub [ebp],ebx                         þ  dropüüüüüüüüüüüüüüüüü;ýüüüüüüüüüüü                      þþþþþþ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  þþþþþ   forthþMULTIPLY AND DIVIDE macroþDEFINITIONS                                                                                           *ÿ0Fhýc,ýAFhýc,ý5Dhýc,ý00hýc,ýýýimul ebx,[ebp]        ýýýýýýýý    83hýc,ýEDhýc,ý04hýc,ýýý     ;ýsub ebp,4                                                                                       /modÿ33hýc,ýD2hýc,ý         xor edx,edx                   ÿýý   ýýýýý8Bhýc,ý45hýc,ý00hýc,ýýýmov eax,[ebp]                       ýýýýýF7hýc,ýFBhýc,ý         idiv ebx                          ýýýýýýý8Bhýc,ýD8hýc,ý         mov ebx,eax                         ýýýýý89hýc,ý55hýc,ý00hýc,ý;ýmov [ebp],edx                                                                                       */ÿ83hýc,ýEDhýc,ý08hýc,ýýýsub ebp,8                         ÿýýýýýý8Bhýc,ý45hýc,ý04hýc,ý  mov eax,[ebp+4]                       ýýýF6hýc,ý6Dhýc,ý08hýc,ý  imul [ebp+8]                          ýýýF7hýc,ýFBhýc,ý         idiv ebx                              ýýý8Bhýc,ýD8hýc,ý       ;ýmov ebx,eax                þþþ  forthþLOGICAL OPERATIONS macroþDEFINITIONS                                                                                            andÿ23hýc,ý5Dhýc,ý00hýc,ýþþand ebx,[ebp]                   ÿÿÿýý    83hýc,ýEDhýc,ý04hýc,ý;ýsub ebp,4                       þþ  þÿorÿ0Bhýc,ý5Dhýc,ý00hýc,ýþþor ebx,[ebp]                    ÿÿþþ     83hýc,ýEDhýc,ý04hýc,ý;ýsub ebp,4                        þþ  xorÿ33hýc,ý5Dhýc,ý00hýc,ýþþxor ebx,[ebp]                    ÿÿþþ    83hýc,ýEDhýc,ý04hýc,ý;ýsub ebp,4                        þþ                                                                  invertÿF7hýc,ýD3hýc,ý;ýnot ebx                                                                                                                                                                                                                                                                                                                                                                                                                þþþþþþþþþþ  forthþRETURN STACK RELATED macroþDEFINITIONS                                                                                           pushÿ53hýc,ýýýpush ebx                                               dropü  ;ý                                                                                                                   popÿdupü                                                        üüüü5Bhýc,ý;ýpop ebx                                                                                                          rdropÿ58hýc,ý;ýpop eax                                      þþýý                                                                                                                                                                                                                                                                                                                                                                                                                                                   þþþþþ  forthþMEMORY ACCESS macroþDEFINITIONS                                                                                                 @ÿ8Bhýc,ý1Bhýc,ý;ýmov ebx,[ebx]                               ýý                                                                c@ÿ8Ahýc,ý1Bhýc,ýý       ýmov bl,[ebx]                             0Fhýc,ýB6hýc,ýDBhýc,ý;ýmovzx ebx,bl                                                                                          !ÿ8Bhýc,ý45hýc,ý00hýc,ýýýmov eax,[ebp]                         ý  89hýc,ý03hýc,ýýýýýýýýýýmov [ebx],eax                            83hýc,ýEDhýc,ý08hýc,ýýýsub ebp,8                                8Bhýc,ý5Dhýc,ý04hýc,ý;ýmov ebx,[ebp+4]                     ýý                                                                 c!ÿ8Ahýc,ý45hýc,ý00hýc,ýýýmov al,[ebp]                    ÿÿýýýý   88hýc,ý03hýc,ýýýýýýýýýýmov [ebx],al                             83hýc,ýEDhýc,ý08hýc,ýýýsub ebp,8                                8Bhýc,ý5Dhýc,ý04hýc,ý;ýmov ebx,[ebp+4]          þþþþ   forthþCOMPARISON TO ZERO macroþDEFINITIONS           ÿÿÿÿÿÿÿÿÿÿÿÿ                                                                     _compare1ÿ83hýc,ýFBhýc,ý00hýc,ý ýcmp ebx,0                                0Fhýc,ý        ýýýýýý;ý(first of of set?)    ýýýý ýý  _compare2ÿüüüüc,ýFBhýc,ýýý       (second half of set?) ÿýýýýýýýýýýýýýýýýýý0Fhýc,ýB6hýc,ýDBhýc,ý;ýmovzx ebx,bl                 ýý                                                                          ýýýýý                                                ü0=ÿ_compare1ü94hý_compare2ü;ý                      ÿüýüýýýþþý   0<>ÿ_compare1ü95hý_compare2ü;ýýý                            üüü 0<ÿ_compare1ü9Chý_compare2ü;ýý                                  0>ÿ_compare1ü9Fhý_compare2ü;ýý                                  0<=ÿ_compare1ü9Ehý_compare2ü;ýýý                              ü 0>=ÿ_compare1ü9Dhý_compare2ü;ýýý                            üüü                                                                                                                    þþþ    forthþCOMPARISON macroþDEFINITIONS              ÿÿÿÿÿÿÿÿÿÿÿÿ  ÿÿÿÿÿÿÿÿ                                                                _compare1ÿ3Bhýc,ý5Dhýc,ý00hýc,ý ýcmp [ebp],ebx                  ýýýýýý    0Fhýc,ýýýýýýýýýýýýýýý;ý(first half of set?)   þþþþþþ  _compare2ÿüüüüc,ýFBhýc,ýý       ý(second half of set?) ýýýýýýýýýýýýýýýýýýý0Fhýc,ýB6hýc,ýDBhýc,ý ýmovzx ebx,bl                 ýý          nipü;ý                                               ü          ýýýýý                                                ü=ÿ_compare1ü94hý_compare2ü;ýý                       ÿüýüýýýþþýý <>ÿ_compare1ü95hý_compare2ü;ýýý                            üüüý <ÿ_compare1ü9Fhý_compare2ü;ýý                                 ý >ÿ_compare1ü9Chý_compare2ü;ýý                                 ý <=ÿ_compare1ü9Dhý_compare2ü;ýýý                              üý >=ÿ_compare1ü9Ehý_compare2ü;ýýý                            üüüý                                                                                                                      þþþ  forthþFLOW CONTROL macroþDEFINITIONS                                  code-pointerÿdupü8Dhýc,ý5Fhýc,ý04hýc,ý;ýlea ebx,[edi+4] ýýýýýýýýhereÿcode-pointerü@ü;ý    þ                      þ       ÿÿÿÿÿÿÿ                                                                ifÿ8Bhýc,ýCBhýc,ý         mov ecx,ebx  dropü                    ÿÿÿ83hýc,ýF9hýc,ý00hýc,ýýýcmp ecx,0 üüüüüü       üüüüüüüüýÿÿÿÿÿþ   74hýc,ýhereýýý00hýc,ý;ýje +0                          üüüüüüüthenÿhereýoverý1+ý-ýswapýc!ý;ýbackpatch          ÿüüüüüüü       elseÿEBhýc,ýhereýýý00hýc,ýýýjmp +0  ýýýýýýýýýýýýýýýýýýýýýýýýýýýý     swapýthenü;ý                                              ý                                                                beginÿhereý;ý                                                  ýuntilÿ8Bhýc,ýCBhýc,ýýýýýýýýýýmov ecx,ebx  dropü       üüüüüüüüý      ÿ83hýc,ýF9hýc,ý00hýc,ýýýcmp ecx,0      ü       üüüüüüüüýÿÿÿ  ýýýý74hýc,ýhereý1+ý-ýýc,ý;ýje +0                      ýýý   ý                                             þ       þþþ   forthþCALLING EXTERNAL ROUTINES ýýýýýýýýýýýýýýýýýý           þþþþþþþþýfunction-tableÿdupý8Bhþc,þ5Fhþc,þ0Chþc,þ;ýmov ebx,[edi+12]      externalÿ4ý*ýfunction-tableý+ý@ýcompile,ý;ý               ÿ     return-valueÿdupý8Bhþc,þD8hþc,þ;ýmov ebx,eax                 üüü                                                                                                                                                                                                Table of external entry points                                  loadÿpushý0þexternalþrdropý;ýýýýýýýýýýýýýload(x) þþþþþþþ   ýýýýýÿÿÿ.ÿpushý1þexternalþrdropý;ýýýýýýýýýýýýýprint_number(x)   ýýýýýÿkeyÿ     2þexternalþreturn-valueý;ý    ýx=key()          ÿýý  ýemitÿpushý3þexternalþrdropý;ý            emit(x)                                                                                                                                                                                                                              þþþþþþþþþþþþþþþþþþþþþþ                 þþþ  forthþCONVIENCE SHORTCUTS                                                                                                             +!ÿdupýpushý@ý+ýpopý!ý;ý                                    ÿÿÿÿ/ÿ/modýnipý;ý                                             ÿÿÿÿÿÿmodÿ/modýdropý;ý                                      ÿÿÿÿÿÿÿÿÿÿ2dupÿoverýoverý;ý                                              ýcrÿ10ýemitý;ý                                                                                                             ýÿÿÿÿÿ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                DEFINE NON-MACRO VERSIONS OF BASIC WORDS                        nipÿnipý;ýýýswapÿswapý;ýýýdropÿdropý;ýýýdupÿdupý;ýýýoverÿoverý;ý+ÿ+ý;ýýý-ÿ-ý;ýýý*ÿ*ý;ýýý/modÿ/modý;ýýý*/ÿ*/ý;ý              ÿÿýý1+ÿ1+ý;ýýý1-ÿ1-ý;ýýý2+ÿ2+ý;ýýý2-ÿ2-ý;ýýý4+ÿ4+ý;ýýý4-ÿ4-ý;ý  ýÿÿýnegateÿnegateý;ý                                                andÿandý;ýýýorÿorý;ýýýxorÿxorý;ýýýinvertÿinvertý;ýÿÿýýýýýÿÿÿÿÿÿý@ÿ@ý;ýýýc@ÿc@ý;ýýý!ÿ!ý;ýýýc!ÿc!ý;ý                             ý0=ÿ0=ý;ýýý0<>ÿ0<>ý;ýýý0<ÿ0<ý;ýýý0>ÿ0>ý;ýýý0<=ÿ0<=ý;ýýý0>=ÿ0>=ý;ý=ÿ=ý;ýýý<>ÿ<>ý;ýýý<ÿ<ý;ýýý>ÿ>ý;ýýý<=ÿ<=ý;ýýý>=ÿ>=ý;ýýýýýýýýýýýýý                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                PRIME NUMBER TEST                                               indivisibleÿmodý0<>ý;ý                                     ýýýýýpart-primeÿdupý1ý=ýifýdropýdropý1ýelseý2dupý1-ýpart-primeý   ýýý ýýýýýýýýý pushýindivisibleýpopýandýthený;ýýýýýýýýýýýýýýýýýýýýýýprimeÿdupý1-ýpart-primeý;ý              ýýýýýýýýýýýýýýýýýýýýýýýýprint-if-primeÿdupýprimeýifý.ýelseýdropýthený;ý            ýý   primesÿ2ýbeginýdupýprint-if-primeý1+ý2dupýswapý>ýuntilýdropý;ýý 1000þprimesþcrþ                                              þþþ                                                                                                                                                                     þþþþþþþþþþþþþþþþþþþþþþþþþþþ                                                                þþþþ                                                                                                                                             þ                                             û                                                                EMIT TEST                                                                                                                       one-keyÿbeginýkeyýdupýemitý27ý=ýuntilý;ýÿÿÿÿÿÿÿÿÿÿÿÿýýý    ýýýýýone-keyþ                                                       þ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                fdsfdssþ                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        