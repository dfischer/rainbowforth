<html>
<head>
<title>{{ haiku.title }}</title>
<meta http-equiv="X-UA-Compatible" content="chrome=1"> 

<style type="text/css">
body {
  font-family: Verdana, Arial, Helvetica, sans-serif;
}

div.haiku_text {
  font-family: "Courier New"
               Courier
               "Andale Mono"
               "Fixed"
               "Lucidatypewriter"
               monospace;
}
</style>

<link href="/favicon.ico" rel="SHORTCUT ICON">                
<link href="http://forthsalon.appspot.com/favicon.png"        
 rel="apple-touch-icon-precomposed">                          
<meta name="viewport" content="width=device-width">           
<meta name="viewport" content="initial-scale=1.0">            
<meta name="viewport" content="maximum-scale=1.0">            
<meta name="viewport" content="user-scalable=0">              
<meta name="apple-mobile-web-app-capable" content="yes"/>     
<meta name="apple-mobile-web-app-status-bar-style"            
 content="black-translucent"/>                      
</head>

<body onload="init();" bgcolor="#ffffff">

<h1 id="loading">Loading...</h1>

{% for haiku in haikus %}
<center id="item{{ forloop.counter0 }}">

<div class="haiku">
<span name="haiku" width="{{ haiku_size }}" height="{{ haiku_size }}">
<textarea style="display: none">{{ haiku.code|escape }}</textarea>
</span>
</div>

<h1>{{ haiku.title|escape }}</h1>
<h2><i>{{ haiku.author|escape }}</i></h2>

<div class="haiku_text">
{{ haiku.code_formatted_print }}
</div>

</center>
{% endfor %}

<script type="text/javascript" src="/static/haiku.js"></script>
<script type="text/javascript">

var haiku_count = {{ haiku_count }};
var last_tm = new Date().getTime();
var current_slide = 0;
var slide_order = [];

function init() {
  // Pick a random order.
  for (var i = 0; i < haiku_count; i++) {
    slide_order.push([Math.random(), i]);
  }
  slide_order.sort();

  // Update haikus and switch.
  update_haikus(function() {});
  setInterval(change, 30);

  window.onkeydown = function(e) {
    if (e.which == 37) {
      current_slide = (current_slide + haiku_count - 1) % haiku_count;
      pick_slide(current_slide);
    } else if (e.which == 39) {
      current_slide = (current_slide + 1) % haiku_count;
      pick_slide(current_slide);
    }
  };
}

function change() {
  var tm = new Date().getTime();
  if (tm - last_tm < {{ speed }} * 1000) return;

  current_slide = (current_slide + 1) % haiku_count;
  pick_slide(current_slide);
}

function pick_slide(index) {
  last_tm = new Date().getTime();

  var tag = document.getElementById('loading');
  tag.style.visibility = 'hidden';
  tag.style.display = 'none';

  var pick = slide_order[index][1];
  for (var i = 0; i < haiku_count; i++) {
    var tag = document.getElementById('item' + i);
    if (i == pick) {
      tag.style.visibility = 'visible';
      tag.style.display = 'inline';
    } else {
      tag.style.visibility = 'hidden';
      tag.style.display = 'none';
    }
  }
}
</script>

</body>
</html>
