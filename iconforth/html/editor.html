<meta http-equiv="X-UA-Compatible" content="chrome=1">
<html>
<head>
<title>Icon Forth</title>
</head>
<body>

<canvas name="bigicon" width="300" height="257" border="0" style="cursor: crosshair;"></canvas>
<form name="frm" action="/write" method="post">
  <textarea name="description" cols="30" rows="8"></textarea><br>
  <div name="deficons"></div>
  <input name="definition" type="hidden">
  <input name="icon" type="hidden">
  <input name="g" type="submit" value="Add"><br>
</form>

<iframe src="/results"
  width="300" height="400" frameborder="0">
</iframe>

<script type="text/javascript">

var drawing = 0;
var color = 0;
var cv = document.getElementsByName("bigicon");
var ctx = cv[0].getContext("2d");
var grid = new Array();

function update_form() {
  // update image
  var str = "";
  for (var y = 0; y < 16; y++) {
    for (var x = 0; x < 16; x++) {
      if (grid[x+y*16]) {
        str += "1";
      } else {
        str += "0";
      }
    }
  }
  document.frm.icon.value = str;

  // update definition
  var d = document.getElementsByName("deficons")[0];
  var str = "";
  for (var i = 0; i < d.children.length; i++) {
    if (str.length) { str += " "; }
    str += d.children[i].alt
  }
  document.frm.definition.value = str;
}

function getpixel(x, y) {
  if (x < 0 || x > 15 || y < 0 || y > 15) return;
  return grid[x+y*16];
}

function plot(x, y, on) {
  if (x < 0 || x > 15 || y < 0 || y > 15) return;
  if (getpixel(x, y) == on) return;
  if (on) {
    ctx.fillStyle = "#000000";
  } else {
    ctx.fillStyle = "#ffffff";
  }
  grid[x+y*16] = on;

  ctx.beginPath();
  ctx.rect(x*16+1, y*16+1, 15, 15);
  ctx.closePath();
  ctx.fill();

  ctx.beginPath();
  ctx.rect(262+x*2, 6+y*2, 2, 2);
  ctx.closePath();
  ctx.fill();
}

function blank() {
  ctx.clearRect(0, 0, 300, 257);

  ctx.fillStyle = "#777777";
  ctx.beginPath();
  ctx.rect(0, 0, 300, 257);
  ctx.closePath();
  ctx.fill();

  for(var z = 0; z < 16 * 16; z++) {
    grid[z] = -1;
  }

  for (var x = 0; x < 16; x++) {
    for (var y = 0; y < 16; y++) {
      plot(x, y, 0);
    }
  }
}

function mousedown(evt) {
  var x = Math.floor((evt.pageX - 8) / 16);
  var y = Math.floor((evt.pageY - 8) / 16);
  color = !getpixel(x, y);
  plot(x, y, color);
  drawing = 1;
}

function mouseup(evt) {
  drawing = 0;
  update_form();
}

function mousemove(evt) {
  if (drawing) {
    var x = Math.floor((evt.pageX - 8) / 16);
    var y = Math.floor((evt.pageY - 8) / 16);
    plot(x, y, color);
  }
}

function drop(e) {
  var d = document.getElementsByName("deficons")[0];
  d.removeChild(e);
  update_form();
}

function pick(id) {
  var d = document.getElementsByName("deficons")[0];
  var im = document.createElement("img");
  im.setAttribute("src", "/icon/" + id + ".png");
  im.setAttribute("alt", id);
  im.setAttribute("style", "cursor: hand;");
  im.setAttribute("onclick", "drop(this)");
  d.appendChild(im);
  update_form();
}

function init() {
  blank();
  document.onmousedown = mousedown;
  document.onmouseup = mouseup;
  document.onmousemove = mousemove;
}

init();

</script>

</body>
</html>
